<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.video.web.main.mapper.VideoStatsMapper">
    <update id="addVideoStats">
        update video_stats
        set play    = play + IFNULL(#{play}, 0),
            comment = comment + IFNULL(#{comment}, 0),
            collect = collect + IFNULL(#{collect}, 0),
            coin    = coin + IFNULL(#{coin}, 0),
            good    = good + IFNULL(#{good}, 0),
            danmu   = danmu + IFNULL(#{danmu}, 0)
        where vid = #{vid}
    </update>
    <update id="updateVideoStats">
        update video_stats
        set play    = #{play},
            comment = #{comment},
            collect = #{collect},
            coin    = #{coin},
            good    = #{good},
            danmu   = #{danmu}
        where vid = #{vid}
    </update>
    <insert id="batchAddStats">
        <foreach collection="list" item="e" index="index" separator=",">
            INSERT INTO video_stats (vid, coin, collect, good)
            VALUES (#{e.vid}, #{e.coin}, #{e.collect}, #{e.good})
            ON DUPLICATE KEY UPDATE
            coin = IFNULL(coin, 0) + IFNULL(#{e.coin}, 0),
            collect = IFNULL(collect, 0) + IFNULL(#{e.collect}, 0),
            good = IFNULL(good, 0) + IFNULL(#{e.good}, 0)
        </foreach>
    </insert>
</mapper>